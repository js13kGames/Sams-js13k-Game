let context;const twoPI=2*Math.PI;let s4c=0,s4f=.2;function sso(){window.AudioContext=window.AudioContext||window.webkitAudioContext,context=new AudioContext}function constSineB(e,t){return cst(Math.round(Math.sin(e/(t+e/100))),0,.1)}function constSineB2(e,t){return cst(Math.round(Math.sin(e/(t+e/1e3))),0,.1)}function noisey(e,t){return.02*Math.random()}function noisey2(e,t){return.02*Math.random()+cst(Math.round(Math.sin(e/t)),0,.13)}function constSine(e,t){return cst(Math.round(Math.sin(e/t)),0,.1)}function constSine2(e,t){return cst(.3*(Math.sin(e/t)+Math.sin(e/(10+t))),0,.1)}function constSine3(e,t){return cst(.2*Math.random()*(Math.sin(e/t)+Math.sin(e/(100+t))),0,.1)}function constSine4(e,t){return cst(Math.random()*s4f+.3*(Math.sin(e/t)+.3*Math.sin(e/(2+t))),0,.1)}function prS(e,t,i,n){let a=[],s=t.a+t.d+t.r,o=context.sampleRate*s,l=context.sampleRate/e,r=Math.floor(l)*i,c=l/twoPI,h=[];for(let e=0;e<r;e++)h.push(n(e,c));for(let e=0;e<o;e++)a[e]=.4*t.level(e)*h[e%r];return a}function pys(e,t,i,n,a){let s=new Float32Array(e.length);for(var o=0;o<e.length;o++)s[o]=t*e[o];let l=context.createBuffer(1,s.length,context.sampleRate);l.copyToChannel(s,0);let r=context.createBufferSource();r.buffer=l;let c=context.createBiquadFilter();r.connect(c),c.connect(context.destination),r.start(0),c.type=i,c.frequency.value=n,c.gain.value=a}class Envelope{constructor(e,t,i,n){this.a=e,this.d=t,this.s=i,this.r=n,this.aS=e*context.sampleRate,this.dS=t*context.sampleRate,this.rS=n*context.sampleRate,this.rT=this.aS+this.dS}level(e){return e<this.aS?e/this.aS:e<this.rT?1-(1-this.s)*(e-this.aS)/this.dS:this.s*(1-(e-this.rT)/this.rS)}}function cst(e,t,i){return Math.min(Math.max(e,t),i)}let bar=1800,maxbarcount=16;function startBeatMachine(){setInterval(newbar,bar)}let beatinput=[{vals:"xox xoxx",beatval:8,f:playHardHat},{vals:"xx",beatval:2,f:playKick},{vals:"xoxxx",beatval:5,f:playSnare},{vals:"xx",beatval:3,f:playBlaster,v:360},{vals:"oox",beatval:3,f:playWobbleBass,v:40},{vals:" x x",beatval:4,f:playNoiseySynth,v:360}],barcount=0;function newbar(){switch(random()>.3&&barcount%2==1?(beatinput[1].vals="x00x00x0x",beatinput[1].beatval=16):(beatinput[1].vals="xx",beatinput[1].beatval=2),barcount){case 0:beatinput[4].v=40,beatinput[0].vals="xox xoxx";break;case 4:beatinput[4].v=60;break;case 8:beatinput[4].v=40,beatinput[0].vals="x xxooxx";break;case 12:beatinput[4].v=60}for(let e=0;e<beatinput.length;e++)for(let t=0;t<beatinput[e].vals.length;t++)"x"==beatinput[e].vals[t]&&(null!=beatinput[e].v?setTimeout(function(e,t){e(t)},t*bar/beatinput[e].beatval,beatinput[e].f,beatinput[e].v):setTimeout(function(e){e()},t*bar/beatinput[e].beatval,beatinput[e].f));++barcount==maxbarcount&&(barcount=0)}function playSnare(){pys(prS(40,new Envelope(.03,.01,.3,.11),1,noisey2),20,"highpass",1200,4)}function playHats(){pys(prS(400,new Envelope(.05,.01,.5,.01),1,noisey),3,"highpass",2400,4)}function playWobbleBass(e){pys(prS(e,new Envelope(.01,.11,.3,1.81),60,constSine2),12,"highshelf",60,8)}function playNoiseySynth(e){pys(prS(e,new Envelope(.01,.11,.3,1.45),50,constSine4),9,"lowpass",1500,8),++s4c%12==0&&(s4f=1-s4f)}function playHardHat(){pys(prS(8,new Envelope(.01,.01,.11,.13),1,constSine3),8,"lowshelf",840,8)}function playKick(){pys(prS(160,new Envelope(.01,.11,.3,.45),500,constSineB),28,"lowpass",180,12)}function playBlaster(e){pys(prS(e,new Envelope(.01,.11,.3,.35),100,constSineB2),8,"highpass",1080,8)}function playDamageFX(){pys(prS(20,new Envelope(.01,.11,.3,.31),60+Math.floor(20*Math.random()),constSine3),14,"highshelf",1500,2)}let ctx,canvas={},camera={};function setupCamera(){camera.target={x:player.x,y:player.y},camera.w=canvas.w2,camera.h=canvas.h2,camera.speed=24}function cameraFollow(e,t){t-=50,camera.target.x+camera.speed<e?camera.target.x+=camera.speed:camera.target.x-camera.speed>e?camera.target.x-=camera.speed:camera.target.x=e,camera.target.y+camera.speed<t?camera.target.y+=camera.speed:camera.target.y-camera.speed>t?camera.target.y-=camera.speed:camera.target.y=t,camera.left=camera.target.x-camera.w,camera.right=camera.target.x+camera.w,camera.top=camera.target.y-camera.h,camera.bottom=camera.target.y+camera.h}let aboutguy,computer,player,playerMoving,firstEnemyKilled=!1,enemyUpdateCounter=0,maxEnemies=3;function updateEnemies(){for(let e=enemies.length-1;e>=0;e--)enemies[e].update(),enemies[e].hP<=0&&(generateLoot(enemies[e]),enemies.splice(e,1));if(0==enemies.length&&!firstEnemyKilled){firstEnemyKilled=!0,cgd=!1,level1.platforms[level1.platforms.length-1].fill=platformFill;let e=saveData.seedIndex.indexOf(currentLevel);favoritesStatus[e]="Unlocked. Difficulty: "+level1.enemyDifficulty}if(firstEnemyKilled&&"home"!=currentLevel&&!level1.cleared&&enemies.length<maxEnemies&&++enemyUpdateCounter%100==0){let e=Math.floor(Math.random()*level1.platforms.length),t=level1.platforms[e];enemies.push(new Enemy(t.x,t.y-80,e))}}class Enemy extends MovingObject{constructor(e,t,i){super(e,t,40,"#cc30"),this.cup=i,this.nT(),this.trD=10,this.tCO=0,this.roaming=!0,this.gRA="none",this.jumpy=!0,this.rpaul=1600,this.aco=0,this.nextAttack=0,this.ain=25,this.facing,this.attackPower=20,this.dashInterval=60,this.nextDash=0,this.dco=15,this.facing="left",this.lrs=!1,this.atti,this.model=new CoolPath(0,0,":=:=Febqfmnnqlsht`y^o`i*;<:HGsgn_j`a`cmkj*<<:JBW@v]j^ld*=<:JBW@vmnklg*>::JFGI^^^_`_*?=:TPwororsrxwvws*@=:OUrrwtvw*@<:STzxzzvyozrzrx*A=:OProwowsvwrxrs*B=:STwtrrrx*B<:STzxzzvyozrzrx*<<:NAPDRATCV@*;;:H@mhfifefbiakc*;=:ECfgfchcjbkghf","CK1iiagtbctdEB0I@0IC0FF0lc_lf`he^QN0tucQR0QN0tueQR0","*still*Z]]]]Y]]]]*****\\I*XI*YIaQ***walk*F]]]]`Qh]]*****\\@*c@*W@*N@**attack*Fa]]]]RdXa*c<e>**S<]>*`<]>*W<^>*N<S>*d<_>*X<d>*o<j>*dash*R`]]]]PeQs*`F*^L*TL\\N*jL\\N*c@\\FWL^N*a@PF^L*k@fF*S@QFOL*c@sF^L",["rgba(142,203,0,0.0)","rgba(255,232,200,1.0)","rgba(177,91,0,1.0)","rgba(247,141,0,1.0)"])}update(){this.aco++;let e=distance(player.x,player.y,this.x,this.y);if(this.nextAttack<this.aco&&e.d<30){let e=!1;"right"==this.facing&&player.x>this.x?e=!0:"left"==this.facing&&player.x<this.x&&(e=!0),e&&(player.hP-=this.attackPower),this.aNI(2),this.nextAttack=this.aco+this.ain,this.atti=setTimeout(function(e){e.roaming?e.aNI(1):e.aNI(0)},400,this)}this.hP<100&&(this.hP+=.2),this.display(),this.roaming&&(player.cup==this.cup&&this.nextDash<this.aco&&e.d<120?(this.nextDash=this.aco+this.dashInterval,this.target=player.x-30+60*Math.random(),this.dco=0,clearTimeout(this.atti),this.aNI(3)):this.lrs||this.aNI(1),this.dco<15?(this.dco++,15==this.dco&&this.aNI(1),this.lrMaxSpeed=5):this.lrMaxSpeed=2,this.x+this.trD<this.target?(this.moR=!0,this.moL=!1,this.facing="right"):this.x-this.trD>this.target?(this.moR=!1,this.moL=!0,this.facing="left"):(this.roaming=!1,this.moR=!1,this.moL=!1,this.tCO%3==0&&("up"==this.gRA?(this.jump(),console.log("going up")):"down"==this.gRA&&(this.y+=4,console.log("going down "))),this.aNI(0),setTimeout(function(e){e.roaming=!0,e.nT()},this.rpaul,this))),0!=this.sPo&&(this.model.x=this.sPo.x+20,this.model.y=this.sPo.y+20,this.model.update(ctx,"left"==this.facing)),this.lrs=this.roaming}aNI(e){clearTimeout(this.atti),this.model.sai(e)}nT(){this.tCO++;let e=level1.platforms[this.cup];if(this.target=.4*(e.x-e.w2+Math.random()*e.w),this.tCO%3==0&&this.jumpy){let t=[];this.cup>0&&t.push(this.cup-1),this.cup+1<level1.platforms.length&&t.push(this.cup+1);let i=t[Math.floor(Math.random()*t.length)];e=level1.platforms[i],this.target=e.x,i>this.cup?this.gRA="up":this.gRA="down",this.cup=i}}}function creN(){let e=level1.platforms[level1.platforms.length-1];aboutguy=new MovingObject(e.x+150,e.y-30,20,"#22af"),computer=new MovingObject(e.x-150,e.y-30,20,"#447f")}function rfn(){aboutguy.display(),eni(aboutguy,"press E",50),computer.display(),eni(computer,"press E, 1 or 2",50)}function eni(e,t,i){if(0!=e.sPo){if(distance(player.x,player.y,e.x,e.y).d<i){e.irb=!0,ctx.fillStyle="black",ctx.font="10px Georgia";let i=e.sPo;ctx.fillText(t,i.x,i.y-20)}else e.irb=!1}else e.irb=!1}function crap(){let e=level1.platforms[level1.platforms.length-1];"home"==currentLevel?e=level1.platforms[0]:e.x-=130,(player=new MovingObject(e.x,e.y-100,40,"#2a20")).facing="left"}let lastPlayerMovingState=!1,playerJumping=!1;function upl(){player.limitX(),player.display(),playerModel.x=player.sPo.x+20,playerModel.y=player.sPo.y+10,playerMoving=!1,(player.moL||player.moR)&&(playerMoving=!0),(player.jumpForce>0||player.fallSpeed>0)&&!playerJumping?(playerJumping=!0,playerModel.fullRig.sai(2)):0==player.jumpForce&&playerJumping?(playerJumping=!1,rpa()):playerMoving&&!lastPlayerMovingState?playerModel.fullRig.sai(0):!playerMoving&&lastPlayerMovingState&&playerModel.fullRig.sai(3),lastPlayerMovingState=playerMoving,playerModel.update(ctx,"left"==player.facing),player.hP<100&&(player.hP+=.1)}function rpa(){playerMoving?playerModel.fullRig.sai(0):playerModel.fullRig.sai(3)}let aboutguydialogs=["welcome to sam's 13k js 2020 game! what's up?","still talking to me, huh"],computerdialogs=["i'm the computer! press 1 to reach another page, press 2 to process data strips."],dialogUI={open:!1,t:0,counter:0,line:[],lineI:0,displayedText:""},adia=0,cdia=0;function runDialog(){if(dialogUI.open){if(0!=dialogUI.t){let e=getsPo({x:dialogUI.t.x,y:dialogUI.t.y,w2:50,h2:50});dialogUI.x=e.x,dialogUI.y=e.y-70}ctx.fillStyle="white",ctx.fillRect(dialogUI.x,dialogUI.y,100,37),ctx.fillStyle="black",ctx.fillText(dialogUI.displayedText[0],dialogUI.x+5,dialogUI.y+15),ctx.fillText(dialogUI.displayedText[1],dialogUI.x+5,dialogUI.y+26)}aboutguy.irb||computer.irb||(dialogUI.open=!1),computer.irb||(displayLinksUI=!1,displayProcessUI=!1)}function cDi(){dialogDone?(dialogUI.open=!1,dialogDone=!1,aboutguy.irb?adia=(adia+1)%2:cdia=0):cuD()}let dialogDone=!1,maxCharsPerLine=20;function cuD(){let e=makeLine(),t={t:""};e.stop||(t=makeLine()),dialogUI.displayedText=[e.t,t.t]}function makeLine(){let e="",t=!1;for(;!t&&e.length+dialogUI.line[0].length<maxCharsPerLine;)e+=dialogUI.line[0]+" ",dialogUI.line.shift(),0==dialogUI.line.length&&(t=!0,dialogDone=!0);return{t:e,stop:t}}let exitDoorRange=30;function abu(){if("home"==currentLevel){let e=aboutguy.irb;displayLinksUI||displayProcessUI||(e||computer.irb)&&(dialogUI.open?cDi():(dialogUI.open=!0,e?(dialogUI.t=aboutguy,dialogUI.line=aboutguydialogs[adia].split(" ")):(dialogUI.line=computerdialogs[cdia].split(" "),dialogUI.t=computer),cuD()))}else exitdoor.irb&&(currentLevel="home",cRL(),crap(),fadeIn=0,waittime=8)}let cgd=!1;function keypress(){switch(event.keyCode){case 65:player.moL=!0,player.moR=!1,player.facing="left";break;case 68:player.moR=!0,player.moL=!1,player.facing="right";break;case 32:player.fallSpeed<8&&player.jump();break;case 83:player.y<killLine&&!cgd&&player.y++;break;case 69:abu();break;case 49:"start"==currentLevel?(console.log("yo"),currentLevel="home",cRL(),crap()):displayLinksUI=!("home"!=currentLevel||!computer.irb||displayProcessUI);break;case 50:displayProcessUI=!("home"!=currentLevel||!computer.irb||displayLinksUI);break;case 82:break;case 27:displayProcessUI=!1,displayLinksUI=!1,dialogUI.open=!1,idi=!idi}}function keyrelease(){switch(event.keyCode){case 65:player.moL=!1;break;case 68:player.moR=!1}}let shootStopTimeout,mouseIsPressed=!1,mouseX=0,mouseY=0;function mousePressed(){mouseIsPressed=!0,mouseX=event.clientX-canvas.x,mouseY=event.clientY-canvas.y,displayLinksUI||displayProcessUI||"start"==currentLevel||player.shoot(mouseX,mouseY,15),playerModel.sai(4),clearTimeout(shootStopTimeout),shootStopTimeout=setTimeout(function(){rpa()},400)}function mouseReleased(){mouseIsPressed=!1}let idi=!1;function ati(e,t){let i=!1;for(let n=0;n<inventory.length;n++)inventory[n].name==e&&(i=!0,inventory[n].quantity+=t);i||inventory.push({name:e,quantity:t}),uid()}function removeItem(e,t){let i=haveItem(e,t);console.log(i),-1!=i&&(inventory[i].quantity-=t,0==inventory[i].quantity&&inventory.splice(i,1)),uid()}function haveItem(e,t){let i=-1;for(let n=0;n<inventory.length;n++)inventory[n].name==e&&inventory[n].quantity>=t&&(i=n);return i}function firi(e,t){let i=haveItem(e,t);return console.log(i,e),-1!=i&&removeItem(e,t),console.log(i),uid(),i}let slotSize=40,slotmargin=5;function uid(){let e=document.getElementsByClassName("invitem");for(let t=0;t<e.length;t++)e[t].remove();let t={x:canvas.x+slotmargin,y:actionBar.y+slotmargin,w:slotSize,h:slotSize};for(let e=0;e<inventory.length;e++){let i="white";for(let t=0;t<enemyLootTable.length;t++)enemyLootTable[t].name==inventory[e].name&&(i=enemyLootTable[t].fill);let n=div(t,i);n.setAttribute("class","invitem"),t.x+=slotSize+5,n.style.fontSize="10px",n.setAttribute("onclick","useItem('"+inventory[e].name+"')"),n.innerHTML=inventory[e].name+" ("+inventory[e].quantity+")"}}function useItem(e){e==enemyLootTable[3].name?(player.hP=Math.min(player.hP+20,100),removeItem(e,1)):e==cleaningitem&&"home"!=currentLevel&&"true404"!=currentLevel&&(cleanLevel(),removeItem(e,1))}function cleanLevel(){console.log("level cleaned!");let e=saveData.seedIndex.indexOf(currentLevel);clearedStates[e]=!0,level1.cleared=!0,favoritesStatus[e]="Cleared!"}let enemyLootTable=[{name:"angry data strip",fill:"grey",quantity:{min:12,r:14},chance:1},{name:"gold",fill:"gold",quantity:{min:1,r:5},chance:.5},{name:"html bits",fill:"lightblue",quantity:{min:3,r:52},chance:.8},{name:"health pot",fill:"tomato",quantity:{min:1,r:3},chance:.9}],cleaningitem="level clear-tastik",items=[],inventory=[];function generateLoot(e){let t=Math.random();for(let i=0;i<enemyLootTable.length;i++)if(t<enemyLootTable[i].chance){let t=enemyLootTable[i],n=Math.floor(t.quantity.min+Math.random()*t.quantity.r);items.push(new Item(e.x,e.y-50,10,t.fill,t.name,n));let a=items.length-1;items[a].impactForce.x=Math.floor(6+12*Math.random()),Math.random()>.5&&(items[a].impactForce.x*=-1),items[a].initJumpForce=11,items[a].jump()}}function updateItems(){for(let e=0;e<items.length;e++)items[e].update()}class Item extends MovingObject{constructor(e,t,i,n,a,s){super(e,t,i,n),this.name=a,this.looted=!1,this.lra=80,this.pickupRange=10,this.lootSpeed=1,this.quantity=s}update(){if(!this.looted){let e=distance(this.x,this.y,player.x,player.y);if(e.d<this.pickupRange)this.looted=!0,ati(this.name,this.quantity);else if(e.d<this.lra){this.lootSpeed++;let t=this.lootSpeed/e.d;this.speedVect={y:t*e.opp,x:t*e.adj},this.x+=this.speedVect.x,this.y+=this.speedVect.y,this.fallSpeed=0}else this.lootSpeed>1&&this.lootSpeed--;this.display(),0!=this.sPo&&(ctx.fillStyle="#000b",ctx.font="8px bold",ctx.fillText(this.quantity,this.sPo.x+15,this.sPo.y-15))}}}let playerModel,monsterModel,ns1=58,ns2=93;class CoolPath{constructor(e,t,i,n,a,s){this.x=e,this.y=t,this.cmess,this.scale=1.5,this.colors=s,this.unpackModelMessage(i),this.unpackRigMessage(n),this.unpackAnimation(a);for(let e=0;e<this.rig.length;e++)this.rig[e].isRoot&&(this.fullRig=new RigShape(e,this.scale,this.model,this.rig,this.animations,this.colors));this.sai(1),this.timeCounter=0}sai(e){this.selectedAnimation=e,this.fullRig.sai(e)}update(e,t){this.fullRig.upV(),ctx.translate(this.x,this.y),t&&ctx.scale(-1,1),this.fullRig.display(ctx),ctx.resetTransform(),this.timeCounter++,this.timeCounter>this.animations[this.selectedAnimation].animLength&&(this.timeCounter=0)}unpackModelMessage(e){let t=e.split("*");this.model=[];for(let e=0;e<t.length;e++){this.cmess=t[e],this.segments=[];for(let i=5;i<t[e].length;i+=2)if(this.toNum(i,0)<ns2)this.newSeg("L",i,ns1);else{let e=this.segments.length-1;if(e>=0){let t=this.segments[e];if("L"==t.type)this.newSeg("C",i,ns2);else{let e=t.points;e.length<3?e.push({x:this.toNum(i,ns2),y:this.toNum(i+1,ns2)}):this.newSeg("C",i,ns2)}}else this.newSeg("C",i,ns2)}this.model.push({shape:this.toNum(0,ns1),fill:this.toNum(1,ns1),stroke:this.toNum(2,ns1),origin:{x:this.toNum(3,ns1),y:this.toNum(4,ns1)},segments:this.segments})}}unpackRigMessage(e){this.rig=[];let t=e;this.cmess=t;let i=0;for(let e=0;e<t.length;e++){let n=this.rig[this.rig.length-1];if(0==i)this.rig.push({origin:{x:this.toNum(e,ns1)},cnn:[],isRoot:!1});else if(1==i)n.origin.y=this.toNum(e,ns1);else if(i>2){let t=n.cnn[n.cnn.length-1];i%3==0?n.cnn.push({x:this.toNum(e,ns2)}):i%3==1?n.cnn[n.cnn.length-1].y=this.toNum(e,ns2):t.shape=this.toNum(e,ns2)}else 2==i&&"1"==t[e]&&(n.isRoot=!0);++i>2&&this.isns1(t,e+1)&&(i=0)}}unpackAnimation(e){this.animations=[],this.cmess=e;let t=e,i=!1,n=0;for(;!i;){let e=t.indexOf("*",n+1),a={name:t.substring(n+1,e)};a.animLength=this.toNum(e+1,ns1);let s=e+1+this.rig.length;a.initVals=[],a.timeStamps=[];for(let t=e+2;t<s+1;t++)a.initVals.push(this.toAngle(t));n=s+1;for(let e=0;e<this.rig.length;e++){a.timeStamps.push([]);let e=t.indexOf("*",n+1),s=0;for(let t=n+1;t<e;t++){let e=a.timeStamps[l(a.timeStamps)-1];s%2==0?e.push({rot:this.toAngle(t)}):e[l(e)-1].time=this.toNum(t,ns1),s++}n=e,-1==e&&(i=!0)}this.animations.push(a)}}newSeg(e,t,i){let n={x:this.toNum(t,i),y:this.toNum(t+1,i)};this.segments.push({type:e,points:[n]})}toNum(e,t){return this.cmess.charCodeAt(e)-t}isns1(e,t){return e.charCodeAt(t)<ns2}toAngle(e){return 180*this.toNum(e,ns2)/30}}class RigShape{constructor(e,t,i,n,a,s){this.colors=s,this.model=i,this.rig=n,this.animations=a,this.sha=e,this.origin={x:this.rig[e].origin.x*t,y:this.rig[e].origin.y*t},this.rotation=0,this.paths=[],this.fill,this.stroke,this.timeCounter=0;for(let i=0;i<this.model.length;i++)if(this.model[i].shape==e){let e=this.model[i].origin.x*t,n=this.model[i].origin.y*t,a="M "+e+" "+n+" ";for(let s=0;s<this.model[i].segments.length;s++){a+=this.model[i].segments[s].type+" ";for(let o=0;o<this.model[i].segments[s].points.length;o++)a+=(e=this.model[i].segments[s].points[o].x*t)+" "+(n=this.model[i].segments[s].points[o].y*t),a+=" "}this.paths.push({path:new Path2D(a),stroke:this.model[i].stroke,fill:this.model[i].fill})}this.cnn=[];for(let i=0;i<this.rig[e].cnn.length;i++)this.cnn.push({shape:new RigShape(this.rig[e].cnn[i].shape,t,this.model,this.rig,this.animations,this.colors),x:this.rig[e].cnn[i].x*t,y:this.rig[e].cnn[i].y*t})}sai(e){this.selectedAnimation=e;for(let t=0;t<this.cnn.length;t++)this.cnn[t].shape.sai(e)}upV(){0==this.timeCounter?this.rotation=this.animations[this.selectedAnimation].initVals[this.sha]:this.rotation=this.getRotFromTimeStamps();for(let e=0;e<this.cnn.length;e++)this.cnn[e].shape.upV();this.timeCounter++,this.timeCounter>this.animations[this.selectedAnimation].animLength&&(this.timeCounter=0)}display(e){e.save(),e.rotate(rad(this.rotation)),e.translate(-this.origin.x,-this.origin.y);for(let t=0;t<this.paths.length;t++)e.strokeStyle=this.colors[this.paths[t].stroke],e.fillStyle=this.colors[this.paths[t].fill],e.fill(this.paths[t].path),e.stroke(this.paths[t].path);for(let t=0;t<this.cnn.length;t++)e.save(),e.translate(this.cnn[t].x,this.cnn[t].y),this.cnn[t].shape.display(e),e.restore();e.restore()}getRotFromTimeStamps(){let e,t=this.animations[this.selectedAnimation].timeStamps[this.sha],i=!1;if(t.length>0){for(let n=0;n<t.length;n++)if(this.timeCounter<=t[n].time&&!i){let a=0,s=0;n>0?(a=t[n-1].time,s=t[n-1].rot):(a=0,s=this.animations[this.selectedAnimation].initVals[this.sha]),e=s+(this.timeCounter-a)/(t[n].time-a)*(t[n].rot-s),i=!0}if(!i){let i=t[t.length-1].time,n=t[t.length-1].rot;e=n+(this.timeCounter-i)/(this.animations[this.selectedAnimation].animLength-i)*(this.animations[this.selectedAnimation].initVals[this.sha]-n)}}return e}}function loadModelData(){(playerModel=new CoolPath(0,0,":;:JFHF*;;:PAo^e^fffppnqf*<<:DQip`hmkqmqulv*<=:DQexjylv*=>:=H_ddcckdmaq`k*>=:?L_mciepjpfubo*?>:@Hdmaq`k_ddcck*@=:?L_mciepjpfubo*A=:TJvirktntqzswm*B;:SNUOTRzuyvvvSQ*C=:QKrkviwmzstqtn*D;:SNUOTRzuyvvv*;=:PCrhojpfnjlimfEB*B=:SNsoylxr*D=:SNsoylxr*@;:@REONTOSKPloiogp@O*@:<@RFNNS","HM1nm`jwdkp_hwffmbHG0HM0kj^>D0bma?J0>D0bmc?J0RI0vpeSM0RI0vpgSM0","*run*L^]]S]WV^^f**ZC**C*SC*cC*]C*`C*eC*VC*]C*gethit*F]]]]]]]]]]]*U=*Z=_B**H=XB*U=OB*T=aB*U=RB*a=[B*g=bB*n=^B*_=iB*fall*RbZ]YZlSQ]W]*]CbK*[CUK*]K*QCWK*^K*kCiK*[C[K*NCRK*kCaK*LC[K*jC`K*nothing*R]\\]Z]Y]Z_[^**_E**]E*VE*\\E*WE*****shooting*F]]]]]_[]]]]*[<*X<**W<*L<*U<*T<*_<*[<*_<*",["rgba(254,255,247,0.0)","rgba(0,0,0,1.0)","rgba(255,154,33,1.0)","rgba(53,77,230,1.0)","rgba(240,112,0,1.0)"])).fullRig.sai(1)}class MovingObject extends DisplayObject{constructor(e,t,i,n){super(e,t,i,i),this.fill=n,this.hasGravity=!0,this.fallAcc=2,this.lrMaxSpeed=10,this.lrAcc=1,this.lrFriction=2,this.initJumpForce=25,this.moL=!1,this.moR=!1,this.jumpForce=0,this.jumpDecel=2.2,this.fallSpeed=0,this.lrSpeed=0,this.impactForce={x:0,y:0},this.hP=100}display(){this.moveLeftRight(),this.applyPhysics(),this.uons(),0!=this.sPo&&(ctx.fillStyle=this.fill,ctx.fillRect(this.sPo.x,this.sPo.y,this.w,this.h),this.hP<100&&this.displayHealthBar())}displayHealthBar(){let e=this.sPo.y-25,t=this.sPo.x;ctx.fillStyle="white",ctx.fillRect(t,e,30,10),ctx.fillStyle="red",ctx.fillRect(t,e,30*this.hP/100,10)}jump(){this.jumpForce=this.initJumpForce}moveLeftRight(){this.moL&&!this.moR?(this.lrSpeed-=this.lrAcc,this.lrSpeed=Math.max(this.lrSpeed,-this.lrMaxSpeed)):this.moR&&!this.moL?(this.lrSpeed+=this.lrAcc,this.lrSpeed=Math.min(this.lrSpeed,this.lrMaxSpeed)):this.lrSpeed+this.lrFriction<0?this.lrSpeed+=this.lrFriction:this.lrSpeed-this.lrFriction>0?this.lrSpeed-=this.lrFriction:this.lrSpeed=0,this.impactForce.x>0?this.impactForce.x--:this.impactForce.x<0&&this.impactForce.x++,this.x+=this.lrSpeed+this.impactForce.x}applyPhysics(){this.updateFallSpeed(),this.jumpForce-this.jumpDecel>0?this.jumpForce-=this.jumpDecel:this.jumpForce=0,this.y+=this.fallSpeed-this.jumpForce}updateFallSpeed(){let e=level1.platforms,t=killLine;for(let i=0;i<e.length;i++)this.x>e[i].x-e[i].w2&&this.x<e[i].x+e[i].w2&&e[i].y>=this.y+this.h/2&&e[i].y<t&&(t=e[i].y,this.cup=i);this.y+this.h/2+this.fallSpeed<t?this.fallSpeed+=this.fallAcc:(this.y=t-this.h/2,this.impactForce.y=this.fallSpeed,this.impactForce.y>36&&(this.hP-=this.impactForce.y/2),this.fallSpeed=0)}}class DisplayObject{constructor(e,t,i,n){this.x=e,this.y=t,this.w=i,this.h=n,this.w2=this.w/2,this.h2=this.h/2}uons(){chC(getBounds(this),camera)?this.sPo=getsPo(this):this.sPo=!1}limitX(){this.x=Math.min(Math.max(this.x,-sceneW/2),sceneW/2)}shoot(e,t,i){e<this.sPo.x?this.facing="left":this.facing="right",projectiles.push(new Projectile(this.x,this.y,4,"black",i,e,t))}}function chC(e,t){return(e.right>=t.left&&e.right<=t.right||e.left>=t.left&&e.left<=t.right||e.left<=t.left&&e.right>=t.right)&&(e.bottom>=t.top&&e.bottom<=t.bottom||e.top>=t.top&&e.top<=t.bottom||e.top<=t.top&&e.bottom>=t.bottom)}function getsPo(e){return{x:canvas.w2+e.x-camera.target.x-e.w2,y:canvas.h2+e.y-camera.target.y-e.h2}}class Projectile extends MovingObject{constructor(e,t,i,n,a,s,o){super(e,t,i,n),this.destroyed=!1,this.y-=20,this.uons();let l=this.sPo,r=distance(l.x,l.y,s,o),c=a/r.d;this.speedVect={y:c*r.opp,x:c*r.adj},this.hasGravity=!1,this.lifeTimer=0}upPr(){this.lifeTimer++,this.destroyed?this.display():(this.x+=this.speedVect.x,this.y+=this.speedVect.y,this.uons(),0!=this.sPo&&(this.chfc(level1.platforms,!1),this.chfc(enemies,10),this.checkWallCollisions(),ctx.fillStyle=this.fill,ctx.fillRect(this.sPo.x,this.sPo.y,this.w,this.h)))}checkWallCollisions(){(this.x<-sceneW/2||this.x>sceneW/2)&&this.stopProjectile()}chfc(e,t){for(let i=0;i<e.length;i++)if(chC(getBounds(e[i]),getBounds(this))&&(this.stopProjectile(),0!=t)){e[i].hP-=t;let n=t/2;e[i].impactForce.x+=Math.min(Math.max(e[i].x-this.x,-n),n)}}stopProjectile(){this.speedVect.x=0,this.speedVect.y=0,this.destroyed=!0}}let projectiles=[];function upPrs(){for(let e=projectiles.length-1;e>=0;e--)projectiles[e].upPr(),projectiles[e].lifeTimer>50&&projectiles.splice(e,1)}let saveData=null;function loadSave(){null==(saveData=localStorage.getItem(saveDataHeader))&&newGameSave()}function newGameSave(){saveData={seedIndex:[],seedData:[],linkNames:[]}}let canvasElw,canvasElh,saveDataHeader="sams404gameforjs13kof2020";function saveGame(){localStorage.setItem(saveDataHeader,JSON.stringify(saveData))}function createCanvas(){canvas.w=600,canvas.h=400,canvas.w2=canvas.w/2,canvas.h2=canvas.h/2,canvas.canvas=document.createElement("canvas"),canvas.canvas.setAttribute("width",canvas.w),canvas.canvas.setAttribute("height",canvas.h),document.body.appendChild(canvas.canvas),ctx=canvas.canvas.getContext("2d");let e=canvas.canvas.getBoundingClientRect();canvas.x=Math.round(e.x),canvas.y=Math.round(e.y)}function resizeCanvas(){let e={x:canvas.x,y:canvas.y+canvas.h,w:canvas.w,h:50};setStyle(actionBar.el,e,actionBarFill),e.w=.9*e.w,setStyle(actionBar.inventory,e,"grey"),e.x+=e.w,e.w=.1*e.w/.9,setStyle(actionBar.right,e,"blue")}window.onresize=resizeCanvas;let noiseSeed=0,seedStorageHeader="sams404gameseed",seedDataLength=100,maxCharVal=100,charStartVal=128;function srs(e){if(!saveData.seedIndex.includes(e)){let t="";for(let e=0;e<seedDataLength;e++)t+=String.fromCharCode(charStartVal+Math.floor(Math.random()*maxCharVal));saveData.seedData.push(t),localStorage.setItem(seedStorageHeader+e,t),saveData.seedIndex.push(e)}}let noiseCounter=0;function random(){let e=currentLevel;localStorage.removeItem(seedStorageHeader+"0"),srs(e);let t=getNoiseVal(Math.floor(noiseCounter),e),i=getNoiseVal(Math.ceil(noiseCounter),e);return(noiseCounter+=.7)%1*(i-t)+t}function getNoiseVal(e,t){return e%=seedDataLength,(saveData.seedData[saveData.seedIndex.indexOf(t)].charCodeAt(e)-charStartVal)/maxCharVal}function distance(e,t,i,n){let a=i-e,s=n-t;return{d:Math.sqrt(a*a+s*s),adj:a,opp:s}}function getBounds(e){return{left:e.x-e.w2,right:e.x+e.w2,top:e.y-e.h2,bottom:e.y+e.h2}}function div(e,t){let i=document.createElement("div");return document.body.appendChild(i),setStyle(i,e,t),i}function setStyle(e,t,i){e.setAttribute("style",`position:fixed; left:${t.x}px;top:${t.y}px;width:${t.w}px;height:${t.h}px;background-color:${i};`)}function button(e,t,i,n){let a=div(e,t);return a.id=i,at(a,"onclick",n+"()"),at(a,"onmouseenter",`hover("${i}")`),at(a,"onmouseleave",`unhover("${i}","${t}")`),a}function at(e,t,i){e.setAttribute(t,i)}function hover(e,t){document.getElementById(e).style.backgroundColor="grey"}function unhover(e,t){document.getElementById(e).style.backgroundColor=t}function rad(e){return e*Math.PI/180}function l(e){return e.length}let actionBar={},actionBarFill="black";function setupActionBar(){(actionBar={x:canvas.x,y:canvas.y+canvasElh,w:canvasElw,h:50}).el=div(actionBar,actionBarFill),actionBar.w=.9*actionBar.w,actionBar.inventory=div(actionBar,"grey"),actionBar.x+=actionBar.w,actionBar.w=.1*actionBar.w/.9,actionBar.right=div(actionBar,"blue")}let waittime=5;function ruf(){let e=1;fadeIn>waittime&&(e=1-(fadeIn-waittime)/30),e>0&&(ctx.fillStyle="rgba(0,0,0,"+e+")",ctx.fillRect(0,0,canvas.w,canvas.h)),fadeIn++}let linksUIel,tef,listform,displayLinksUI=!1,lastdisplayState=!1,linksUI={w:260,h:80},linkLoadTime=800;function runLinksUI(){if(displayLinksUI){if(!lastdisplayState){lastdisplayState=!0,dialogUI.open=!1,linksUI.x=canvasElw/2-linksUI.w/2+canvas.x,linksUI.y=canvasElh/2-linksUI.h/2+canvas.y,(linksUIel=document.createElement("div")).setAttribute("style",`padding:10px;position:fixed;left:${linksUI.x}px;top:${linksUI.y}px;width:${linksUI.w}px;height:${linksUI.h}px;background-color:white;font-size:14px;`);let e="";for(let t=0;t<favorites.length;t++)e+=`<option value="${favorites[t]}">status: ${favoritesStatus[t]}</option>`;linksUIel.innerHTML=`Choose from favorites:<br><input list="browsers" name="browser" id="browser" onchange='inputListChanged()'>\n      <datalist id="browsers">\n      ${e}\n      </datalist></input>\n      <br>Or type url name:<br>\n      <input type="text" id="fname" name="fname" value="custom url" onkeydown='formKeyDown()' onclick='fc()'>\n      <div style='font-size:12px;position:absolute; right:26px;top:10px;'><br>select a list<br>item, or type<br>url name and <br>press enter</div>\n      `,document.body.appendChild(linksUIel),tef=document.getElementById("fname"),listform=document.getElementById("browser")}}else lastdisplayState&&linksUIel.remove(),lastdisplayState=!1}function fc(){tef.value=""}function formKeyDown(){13==event.keyCode&&(tef.value=tef.value.trim(),goToLink())}function inputListChanged(){tef.value=listform.value,goToLink()}function goToLink(){let e=tef.value,t=listform.value,i=t;e!=t&&(i=e),linksUIel.innerHTML="loading "+i+"!",fadeIn=0,waittime=24,getLinkSeed(i),noiseCounter=0,cRL(),crap(),setTimeout(function(){displayLinksUI=!1},linkLoadTime)}let difficultyLevels=[];function getLinkSeed(e){let t=saveData.linkNames.indexOf(e);if(-1!=t)currentLevel=saveData.seedIndex[t];else if(allLinkNames.includes(e)){0!=lvlCount&&lvlCount%lvlDiffIncreaseInterval==0&&(enemyDifficulty=Math.min(enemyDifficulty+1,maxEnemyDifficulty)),difficultyLevels.push(enemyDifficulty);let t=favorites.indexOf(e),i="Locked. Difficulty: "+enemyDifficulty;console.log("favindex",t),-1!=t?favoritesStatus[t]=i:(favorites.push(e),favoritesStatus.push(i)),lvlCount++,console.log("difficulty",enemyDifficulty);let n=Math.floor(100*Math.random());for(;saveData.seedIndex.includes(n);)n=Math.floor(100*Math.random());saveData.linkNames.push(e),currentLevel=n}else currentLevel="true404"}let displayProcessUI=!1,allLinkNames=["home","contact","store","gallery","news","events","wormhole","destroy","noob","rekt","acidpool","badfile"],favorites=["home","contact","store"],favoritesStatus=["unknown","unknown","unknown"],clearedStates=[!1,!1,!1],nextLink="",pUI={w:200,h:200,last:!1,el:0};function runProcessUI(){if(displayProcessUI&&!pUI.last){pUI.x=canvasElw/2-pUI.w/2,pUI.y=canvasElh/2-pUI.h/2,dialogUI.open=!1,pUI.el=div(pUI,"white"),pUI.el.innerHTML="spend "+dataCost+" data strips towards discovering a new page";let e={x:pUI.x,y:pUI.y+pUI.h/4,w:pUI.w,h:pUI.h/4};pUI.dataButton=button(e,"yellow","but1","pds"),e.y+=pUI.h/4,pUI.el2=div(e,"white"),pUI.el2.innerHTML="spend "+htmlCost+" html bits towards clearing an html page",e.y+=pUI.h/4,pUI.htmlButton=button(e,"orange","but2","processHTMLBits")}else!displayProcessUI&&pUI.last&&(pUI.el.remove(),pUI.el2.remove(),pUI.dataButton.remove(),pUI.htmlButton.remove());pUI.last=displayProcessUI}let dataCost=50;function pds(){console.log("data strps");let e=firi(enemyLootTable[0].name,dataCost);if(console.log(e),-1!=e){console.log("have!"),""==nextLink&&pickNextLinkAward();let e=Math.floor(Math.random()*revealedLink.length);for(;"_"!=revealedLink[e];)e=Math.floor(Math.random()*revealedLink.length);console.log(e,nextLink),revealedLink=e<nextLink.length-1?revealedLink.substring(0,e)+nextLink[e]+revealedLink.substring(e+1,revealedLink.length):revealedLink.substring(0,e)+nextLink[e],pUI.dataButton.innerHTML=revealedLink,console.log(revealedLink),++revealedChars==revealedLink.length&&(favorites.push(nextLink),favoritesStatus.push("unknown"),clearedStates.push(!1),pickNextLinkAward(),console.log("done"))}}let revealedLink="",revealedChars=0;function pickNextLinkAward(){console.log("reset reward");let e=randomlink();if(favorites.length<allLinkNames.length-1)for(;favorites.includes(e);)e=randomlink();else{let t=4+Math.floor(4*Math.random());e="";for(let i=0;i<t;i++)e+=String.fromCharCode(Math.floor(97+26*Math.random()))}nextLink=e,revealedLink="",revealedChars=0;for(let e=0;e<nextLink.length;e++)revealedLink+="_"}function randomlink(){return allLinkNames[Math.floor(Math.random()*allLinkNames.length)]}let level1,htmlCost=500;function processHTMLBits(){console.log("html bits"),-1!=firi(enemyLootTable[2].name,htmlCost)&&ati(cleaningitem,"1")}function displayStartUI(){ctx.fillStyle="white",ctx.fillRect(0,0,canvas.w,canvas.h),ctx.fillStyle="black",ctx.fillText("sam's js13k game",50,50),ctx.fillText("press 1 to start new game. press 2 to continue.",50,65)}function startNewGame(){}function continueGame(){}function saveAndExit(){}let exitdoor,sceneW=0,fadeIn=0,enemies=[],lvlCount=0,enemyDifficulty=1,lvlDiffIncreaseInterval=3,maxEnemyDifficulty=3;function cRL(){if(enemies=[],items=[],firstEnemyKilled=!1,"home"==currentLevel){sceneW=canvas.w;let e=[[50,killLine-100,100],[-60,killLine-60,100],[0,killLine,canvas.w]];level1=new Level(e,sceneW,Math.abs(e[0][1]-e[e.length-1][1])),cgd=!1,creN()}else if("true404"==currentLevel){sceneW=canvas.w;let e=[[50,killLine-100,100],[-60,killLine-60,100],[0,killLine,canvas.w]],t=(level1=new Level(e,sceneW,Math.abs(e[0][1]-e[e.length-1][1]))).platforms[level1.platforms.length-1];level1.text404=new DisplayObject(t.x-10,t.y-10,300,300),exitdoor=new MovingObject(t.x+50,t.y-50,20,"#a22f"),cgd=!1}else{let e=(sceneW=2*canvas.w)/2,t=[[0,killLine,sceneW]],i=8,n=5+Math.floor(random()*i),a=killLine,s=50,o=150,l=65,r=60,c=.6*(-e+random()*sceneW),h=Math.min(s+random()*o,sceneW-c);for(let i=0;i<n-1;i++){o=i%4==2?300:40,a-=l,t.push([c,a,h]);let n=50,m=Math.floor(3*random())-1;(c<0-n||c>0+n)&&(m=Math.abs(e-c)/(e-c)),c+=m*Math.floor(random()*r),h=Math.min(s+random()*o,(sceneW-c)/2)}let m=t[t.length-1];m[0]=sceneW/8,m[2]=1.2*sceneW;let u=(level1=new Level(t,sceneW,Math.abs(t[0][1]-t[t.length-1][1]))).platforms.length-1;m=level1.platforms[u],level1.text404=new DisplayObject(m.x-10,m.y-10,300,300),exitdoor=new MovingObject(m.x+50,m.y-50,20,"#a22f");let p=saveData.seedIndex.indexOf(currentLevel);level1.enemyDifficulty=difficultyLevels[p],level1.cleared=clearedStates[p],"Unl"==favoritesStatus[p].substring(0,3)?(firstEnemyKilled=!0,cgd=!1):(cgd=!0,m.fill="orange",enemies.push(new Enemy(m.x,m.y-80,u)),enemies[0].jumpy=!1)}}class Level{constructor(e,t,i){this.platforms=[];for(let t=0;t<e.length;t++)this.platforms.push(new Platform(e[t][0],e[t][1],e[t][2]));this.bgFill="#ddff";let n=t/4;this.walls=[new DisplayObject(-t+n,0,t/2,2e3),new DisplayObject(t/2+n,0,t/2,2e3),new DisplayObject(0,killLine+500,2e3,1e3)]}dbg(){ctx.fillStyle=this.bgFill,ctx.fillRect(0,0,canvas.w,canvas.h)}d4b(){this.text404.uons(),ctx.font="100px Georgia",ctx.fillStyle="black",ctx.fillText("404",this.text404.sPo.x,this.text404.sPo.y),ctx.font="30px Georgia",ctx.fillText("return to last page...",this.text404.sPo.x,this.text404.sPo.y+50)}displayPlatforms(){for(let e=0;e<this.platforms.length;e++)this.platforms[e].display();ctx.fillStyle="yellow";for(let e=0;e<this.walls.length;e++){let t=this.walls[e];t.uons();let i=t.sPo;0!=i&&ctx.fillRect(i.x,i.y,t.w,t.h)}}}let platformHeight=10,platformFill="#a43f";class Platform extends DisplayObject{constructor(e,t,i){super(e,t,i,platformHeight),this.fill=platformFill}display(){this.uons(),0!=this.sPo&&(ctx.fillStyle=this.fill,ctx.fillRect(this.sPo.x,this.sPo.y,this.w,this.h))}}window.onload=start;let currentLevel="start",killLine=500;function start(){loadSave(),fadeIn=0,createCanvas(),setupActionBar(),resizeCanvas(),cRL(),crap(),setupCamera(),loadModelData(),sso(),setInterval(run,33)}function run(){if("start"!=currentLevel){let e="home"==currentLevel;cameraFollow(player.x,player.y),level1.dbg(),e||level1.d4b(),level1.displayPlatforms(),e?rfn():runExitDoor(),updateEnemies(),upl(),upPrs(),runDialog(),updateItems(),ruf(),runProcessUI(),runLinksUI()}else displayStartUI()}function runExitDoor(){exitdoor.display(),eni(exitdoor,"press E to return home",exitDoorRange)}
