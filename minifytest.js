let aContext;const twoPI=2*Math.PI;let samprate,startSound=()=>{window.AudioContext=window.AudioContext||window.webkitAudioContext,aContext=new AudioContext,samprate=aContext.sampleRate},preloadSound=(e,t,a,s,l)=>{let i=[],n=samprate*(t.a+t.d+t.r),o=samprate/e,r=flo(o)*a,h=o/twoPI,c=[];if(null==l){for(let e=0;e<r;e++)c.push(s(e,h));for(let e=0;e<n;e++)i[e]=.4*t.level(e)*c[e%r]}else for(let e=0;e<n;e++)i[e]=.4*t.level(e)*s(e,h+e*l);return i},playSound=(e,t,a,s,l)=>{let i=new Float32Array(e.length);for(var n=0;n<e.length;n++)i[n]=t*e[n];let o=aContext.createBuffer(1,i.length,samprate);o.copyToChannel(i,0);let r=aContext.createBufferSource();r.buffer=o;let h=aContext.createBiquadFilter();r.connect(h),h.connect(aContext.destination),r.start(0),h.type=a,h.frequency.value=s,h.gain.value=l};class Envelope{constructor(e,t,a,s){this.a=e,this.d=t,this.s=a,this.r=s,this.aS=e*samprate,this.dS=t*samprate,this.rS=s*samprate,this.rT=this.aS+this.dS}level(e){return e<this.aS?e/this.aS:e<this.rT?1-(1-this.s)*(e-this.aS)/this.dS:this.s*(1-(e-this.rT)/this.rS)}}let cash2timeout,ctx,textSpawnerGuy,aboutguy,bar=1800,maxbars=16,startBeatMachine=()=>setInterval(newbar,bar),bassnote="0",mel2="HJMOMPOPOJMOP",mel1="POMJHHHJMHH",mel=mel1,beatinput=[{vals:" x x x x",beatval:8,f:playHats,p:!0},{vals:"x x",beatval:16,f:playKick,v:600,p:!0},{vals:"     x",beatval:8,f:playSnare,p:!0},{vals:" 5",beatval:8,f:playWobbleBass,v:2e3,p:!0},{vals:"  ",beatval:8,f:playNoiseySynth,v:0,p:!0},{vals:"  M  K  R  P  M  P",beatval:16,f:playSine,v:0,p:!0},{vals:"  P  P  T  R  P  R",beatval:16,f:playSine,v:0,p:!0},{vals:"  R  T  W  T  R  T",beatval:17,f:playSine,v:0,p:!0}],bars=0,section=0,noteToFreq=e=>13.75*2**((e-9)/12),melCounter=0,melCount2=1,newbar=()=>{bars%4==0&&(wubfact2=100+randInt(200),beatinput[7].beatval=16+randInt(2),beatinput[6].beatval=16+randInt(3)),"home"!=currentLevel&&levelData&&!levelData.cleared?(bars%8==0&&(mel!=mel1?(mel=mel1,beatinput[3].vals=" 5"):(mel=mel2,beatinput[3].vals=" 0"),melCount2=1,melCounter=0),beatinput[4].vals="   "+mel[melCounter]+" "+mel[melCounter],++melCounter>=melCount2&&(melCounter=0,melCount2++),melCount2>=mel.length&&(melCount2=0)):(beatinput[4].vals="",beatinput[3].vals="");for(let e=0;e<beatinput.length;e++)if(beatinput[e].p)for(let t=0;t<beatinput[e].vals.length;t++)"x"==beatinput[e].vals[t]?null!=beatinput[e].v?setTimeout(function(e,t){e(t)},t*bar/beatinput[e].beatval,beatinput[e].f,beatinput[e].v):setTimeout(function(e){e()},t*bar/beatinput[e].beatval,beatinput[e].f):null!=beatinput[e].v&&" "!=beatinput[e].vals[t]&&setTimeout(function(e,t){e(t)},t*bar/beatinput[e].beatval,beatinput[e].f,noteToFreq(beatinput[e].vals.charCodeAt(t)-20));++bars==maxbars&&(bars=0,section++)},sine4counter=0,sine4fact=.1,constSineB=(e,t)=>constrain(Math.round(Math.sin(e/(t+e/100))),0,.1),constSineB2=(e,t)=>constrain(Math.round(Math.sin(e/(t+e/1e3))),0,.1),noisey=(e,t)=>.02*Math.random(),noisey2=(e,t)=>Math.random()*constrain(Math.round(Math.sin(e/(e+t))),0,.13),constSine=(e,t)=>constrain(Math.sin(e/t),-.8,.8),wubfact2=200,constSine2=(e,t)=>constrain(.5*(Math.sin(e/t)+Math.sin(e/(wubfact2+t))),0,.1),constSine3=(e,t)=>constrain(.2*Math.random()*(Math.sin(e/t)+Math.sin(e/(100+t))),0,.1),constSine5=(e,t)=>constrain(.2*Math.random()*(Math.sin(e/t)+Math.sin(e/(1e3+t))),0,.1),constSine4=(e,t)=>constrain(Math.random()*sine4fact+.3*(Math.sin(e/t)+.3*Math.sin(e/(2+t))),0,.1),snarerelease=.3,playSnare=()=>play(10,.02,.01,.4,snarerelease,4,noisey2,5,"highpass",1200,4),playCash=()=>{play(1600,.01,.02,.3,.6,2,constSine2,4,"lowpass",1200,2),clearTimeout(cash2timeout),cash2timeout=setTimeout(function(){play(2400,.01,.02,.3,.6,2,constSine2,4,"lowpass",1800,2)},260)},play=(e,t,a,s,l,i,n,o,r,h,c,p)=>{playSound(preloadSound(e,new Envelope(t,a,s,l),i,n,p),o,r,h,c)},playHats=()=>play(40,.01,.01,.5,.8,40,noisey,14,"highpass",6400,6),constSineZ=(e,t)=>constrain(.1*Math.random()+.8*Math.sin(e/(.2*e+t)),0,.6),playHop=e=>play(e,.01,.11,.3,.31,10,constSine2,8,"highpass",500,2,-.001),playHop2=()=>play(200,.01,.11,.3,.31,200,constSineZ,9,"highshelf",1500,2),wubfactor=250,playWobbleBass=e=>play(e,.05,.51,.8,1.41,4,constSine,3.6,"lowpass",wubfactor,10),playNoiseySynth=e=>{play(e,.01,.11,.3,1.45,50,constSine4,8.5,"lowpass",1500,8),++sine4counter%12==0&&(sine4fact=1-sine4fact)},playHardHat=()=>play(8,.01,.01,.11,.13,1,constSine3,6,"lowshelf",2240,12),playKick=e=>play(e,.01,.11,.3,.35,500,constSineB,16,"lowpass",180,12),playBlaster=(e,t)=>play(e,.01,.11,.3,.25,100,constSineB2,t,"highpass",1080,8),playSine=e=>{if("home"!=currentLevel){let t=.15;levelData&&levelData.cleared&&(t=.8),play(e,.01,.11,.3,t,1,constSine,.7,"highpass",600,1)}},playDamageFX=()=>play(20,.01,.11,.3,.31,60+randInt(20),constSine3,14,"highshelf",1500,2),playThunder=()=>play(15+randInt(85),.3,.61,.3,2.81,20+randInt(50),constSine5,4,"lowpass",300+randInt(2200),2),canvas={},camera={},setupCamera=()=>{camera.target={x:player.x,y:player.y},camera.w=canvas.w2,camera.h=canvas.h2,camera.speed=24},cameraFollow=(e,t)=>{t-=50,reach(camera.target,{x:e,y:t},camera.speed),camera.left=camera.target.x-camera.w,camera.right=camera.target.x+camera.w,camera.top=camera.target.y-camera.h,camera.bottom=camera.target.y+camera.h},firstEnemyKilled=!1,enemyUpdateCounter=0,maxEnemies=3,enemyShooterDamage=10,updateEnemies=()=>{if("home"!=currentLevel&&"start"!=currentLevel)for(let e=enemies.length-1;e>=0;e--)enemies[e].update(),enemies[e].limitX(),enemies[e].hitPoints<=0&&(directorylevels.includes(currentLevel)?1==enemies.length?levelData.sections<levelData.difficulty?(levelData.sections++,continueLevel(!0)):level1.cleared||(levelData.cleared=!0,level1.clearLevel(),level1.addSpawner2(),updateFavorites()):level1.cleared&&!level1.cleared2&&generateLoot(enemies[e]):(level1.clearLevel(),levelData.cleared=!0,saveData.bossProgress++,updateFavorites()),poof(enemies[e].x,enemies[e].y,[enemies[e].model.colors[0]]),enemies.splice(e,1))},poof=(e,t,a)=>generateLoot({x:e,y:t},!0,a);class Enemy extends MovingObject{constructor(e,t,a,s,l){let i=1.4,n=60;"boss"==l&&(i=3,n=100),super(e,t,n,"#cc30"),this.type=l,this.lrMaxSpeed=3,this.roamCount=0,this.dashing=!1,this.currentPlatform=a,this.attackCounter=0,this.nextAttack=0,this.attackInterval=25,"boss"==l&&(this.attackInterval=12),this.facing,this.attackPower=20,this.facing="left",this.attackAnimOverTimeout,this.doneSpawning=!1,"spawner2"==l&&pickNextLinkAward(),"spawner"==l||"spawner2"==l?(this.model=new CoolPath(0,0,s1data,2),this.model.fullRig.selectAnimation(0)):this.model=new CoolPath(0,0,edata,i),"shooter"==l&&(this.model.colors[0]="#8a8f"),"fighter"==l&&(this.model.colors[0]="#88af"),this.sIndex=s,this.spawnInterval=200,this.spawnCounter=0,this.enemyCount=0,this.nextSpawn=0,this.unlockdist=0,this.unlocked=!1,this.spawner2interval=150,this.spawner2text=""}updateSpawner(){0!=this.display()&&(this.model.x=this.screenPos.x+20,this.model.y=this.screenPos.y+20,this.model.update(ctx,!1)),this.spawnCounter++}updateSpawner2(){let e,t,a=this.display();if(0!=a){this.unlocked&&this.unlockdist<20&&(this.unlockdist+=2),ctx.save(),ctx.strokeStyle="black",ctx.lineWidth="10",ctx.translate(a.x,a.y),ctx.beginPath(),ctx.fillRect(0,0,10,-this.unlockdist),ctx.arc(30,0-this.unlockdist,25,Math.PI,0),ctx.stroke(),cRect(0,0,60,40,"blue"),cRect(3,12,54,20,"white");for(let a=0;a<revealedLink.length;a++)t="black","_"==(e=revealedLink[a])&&(e=String.fromCharCode(48+randInt(74)),t="grey"),cText(e,6*a+4,25,t,12);for(let e=0;e<dataCost;e++)cFill(e<datastrip%dataCost?"white":"grey"),cRect(5*e,35,4,4);ctx.restore()}this.spawnAtInterval()}spawnAtInterval(){this.spawnCounter++,this.doneSpawning||this.spawnCounter%this.spawner2interval!=0||this.spawnOne()}spawnMore(){for(let e=0;e<3;e++)this.spawnOne()}spawnOne(){let e="fighter";Math.random()>.5&&(e="shooter"),enemies.push(new Enemy(this.x-100+randInt(200),this.y-80,this.currentPlatform,this.sIndex,e))}update(){if("spawner"!=this.type){if("spawner2"==this.type)return console.log("eyy"),void this.updateSpawner2();if(this.display(),0!=this.screenPos){this.attackCounter++;let e=distance(player.x,player.y,this.x,this.y);this.roam(e),"fighter"==this.type?this.fight(e):"shooter"==this.type?this.enemyShooter(e):"boss"==this.type&&(this.fight(e),this.enemyShooter(e)),this.hitPoints<100&&(this.hitPoints+=.2),this.model.x=this.screenPos.x+20,this.model.y=this.screenPos.y+20,this.model.update(ctx,"left"==this.facing)}}else this.updateSpawner()}enemyShooter(e){this.nextAttack<this.attackCounter&&e.d<200&&player.y>this.y-100&&player.y<this.y+100&&(playBlaster(800,1),this.shoot(player.screenPos.x,player.screenPos.y,10,!0),this.animate(1),this.nextAttack=this.attackCounter+this.attackInterval,this.resetEnemyAnim())}resetEnemyAnim(){this.attackAnimOverTimeout=setTimeout(function(e){e.animate(0)},400,this)}fight(e){this.nextAttack<this.attackCounter&&e.d<30&&player.y>this.y-50&&player.y<this.y+50&&(damagePlayer(this.attackPower),this.animate(1),this.nextAttack=this.attackCounter+this.attackInterval,this.resetEnemyAnim())}dash(){this.dashing=!0,this.lrMaxSpeed=6,setTimeout(function(e){e.lrMaxSpeed=3},2e3,this),setTimeout(function(e){e.dashing=!1},4e3,this)}roam(e){this.roamCount%50==0&&(player.x<this.x?this.goLeft():this.goRight(),player.y<this.y&&(e.d<150?this.jump():!this.dashing&&e.d<200&&this.dash())),this.roamCount++}animate(e){clearTimeout(this.attackAnimOverTimeout),this.model.selectAnimation(e)}}let agTalkTimeout,player,playerMoving,fuelregen,amnoregen,createFriendlyNPCs=()=>{let e=level1.platforms[level1.platforms.length-1];aboutguy=new MovingObject(e.x+150,e.y-30,20,nocolor)},lastaboutstate=!1,aboutguytalking=!1,runFriendlyNPCs=()=>{aboutguy.display(),enableInteraction(aboutguy,"press E",80),0!=aboutguy.screenPos&&(aboutModel.x=aboutguy.screenPos.x+8,aboutModel.y=aboutguy.screenPos.y-4,aboutModel.update(ctx,!1),!dUI.open&&lastaboutstate?aboutguytalking=!1:dUI.open&&!lastaboutstate&&(aboutguytalking=!0,aboutGuyTalk())),lastaboutstate=dUI.open},agTalkCounter=8,aboutGuyTalk=()=>{let e=60+randInt(140),t=void 0,a=1200,s=400+randInt(50);Math.random()<.8&&(t=-1e-4*randInt(50),a=200),Math.random()<.8&&play(s,.01*randInt(3),.11,.3,e/1100,10,constSine3,4,"highpass",a,3,t),agTalkCounter--,aboutguytalking&&agTalkCounter>0?(aboutModel.fullRig.selectAnimation(1),agTalkTimeout=setTimeout(aboutGuyTalk,e)):aboutModel.fullRig.selectAnimation(0)},enableInteraction=(e,t,a)=>{if(0!=e.screenPos){if(distance(player.x,player.y,e.x,e.y).d<a){e.interactible=!0;let a=e.screenPos;ctx.fillText(t,a.x+25,a.y-40,"black",10)}else e.interactible=!1}else e.interactible=!1},createPlayer=()=>{let e=level1.platforms[level1.platforms.length-1];"home"==currentLevel?e=level1.platforms[0]:e.x-=130,(player=new MovingObject(e.x,e.y-100,50,"#2a20")).initJumpForce=40,player.facing="left",player.jetFuel=100,player.gunPower=100,setupCamera(),player.display()},lastPlayerMovingState=!1,playerJumping=!1,fuelcost=7,shotcost=38,mcounter=0,wcounter=0,dY=0,updatePlayer=()=>{if(player.limitX(),player.jetpacks&&player.jumpForce<10?player.jetFuel>=fuelcost?(player.jetFuel-=fuelcost,player.jumpForce=10):(cantjetpack=!0,setTimeout(function(){cantjetpack=!1},500),player.jetpacks=!1):player.jumpForce>0?player.jumpForce-=4:player.jumpForce=0,player.display(),playerMoving=!1,(player.movingLeft||player.movingRight)&&(playerMoving=!0),dY=0,playerMoving&&0==player.jumpForce&&0==player.fallSpeed){let e=Math.cos(mcounter);dY=2+e*e*7,mcounter+=.2*Math.PI,wcounter++}(playerMoving||wcounter%5!=0)&&++wcounter%5==0&&0==player.jumpForce&&0==player.fallSpeed&&playHop2(),playerModel.x=player.screenPos.x+20,playerModel.y=player.screenPos.y+14-dY,(player.jumpForce>0||player.fallSpeed>0)&&!playerJumping?(playerJumping=!0,playerModel.fullRig.selectAnimation(5)):0==player.jumpForce&&0==player.fallSpeed&&playerJumping?(playerJumping=!1,resetPlayerAnimation()):playerMoving&&!lastPlayerMovingState?resetPlayerAnimation():!playerMoving&&lastPlayerMovingState&&(resetPlayerAnimation(),playHop2()),lastPlayerMovingState=playerMoving,playerModel.update(ctx,"left"==player.facing),player.hitPoints<100&&(player.hitPoints+=.1),player.hitPoints<=0&&(loadHomeLevel(),fade(60,"ouchies")),amnoregen=awarded("r3")?3:2,player.gunPower=Math.min(player.gunPower+amnoregen,100),fuelregen=awarded("r2")?3:2,cantjetpack||(player.jetFuel=Math.min(player.jetFuel+fuelregen,100))},resetPlayerAnimation=()=>{player.jumpForce>0||player.fallSpeed>0?playerModel.fullRig.selectAnimation(4):playerMoving?playerModel.fullRig.selectAnimation(2):playerModel.fullRig.selectAnimation(0)},damagePlayer=e=>{awarded("r4")&&(e*=.6),player.hitPoints-=e,playDamageFX(),playerModel.selectAnimation(4),setTimeout(function(){resetPlayerAnimation()},400)},texts=["Hmm? # Oh! You must be from the cleaning service. # Thank goodness you're here. # Our web page is being attacked by a mysterious virus! # Our pages have been replaced by fake 404s full of monsters. # Yuck! It's revolting! Here, let me add our directory to your favorites.","what's up ","hey","dope","wee! you cleared a page, good job. see how it was added to your favorites. now go clean more!","that's 2 pages! nice job dude. here's a boost for your *****","that's 4 pages! nice job dude. here's a boost for your *****","that's 6 pages! nice job dude. here's a boost for your *****","almost there guy! go to those boss files and rek whatever creature you might find!","wow you killed a boss dude heres yourd reward","wow thats the second and last boss gj dude u done","thanks for playing sam thanks you now play more","haha yaa go champ","you want a tip # ... # get a job","sup"],dUI={open:!1,t:0,counter:0,line:[],lineI:0,displayedText:""},dialogDone=!1,maxCharsPerLine=20,runDialog=()=>{if(dUI.open){if(0!=dUI.t){let e=getScreenPos({x:dUI.t.x,y:dUI.t.y,w2:50,h2:50});dUI.x=e.x-50,dUI.y=e.y-110}cFill("white"),cRect(dUI.x,dUI.y,250,50),cFill("black"),cFont(20),cText(dUI.displayedText[0],dUI.x+5,dUI.y+20),cText(dUI.displayedText[1],dUI.x+5,dUI.y+40)}aboutguy.interactible||(dUI.open=!1)},continueDialog=()=>{if(dialogDone){dUI.open=!1,dialogDone=!1;let e=saveData.gameProgress;switch(saveData.textProgress){case 0:for(let e=0;e<2;e++)newLevel(allLinkNames[e]);updateFavorites(),e.push("start")}}else cutDialog()},cutDialog=()=>{let e=makeLine(),t={t:""};e.stop||(t=makeLine()),dUI.displayedText=[e.t,t.t]},makeLine=()=>{let e="",t=!1,a=!1;for(;!t&&!a&&e.length+dUI.line[0].length<maxCharsPerLine;)"#"==dUI.line[0]?a=!0:e+=dUI.line[0]+" ",dUI.line.shift(),0==dUI.line.length&&(t=!0,dialogDone=!0);return{t:e,stop:t}},actionButton=()=>{"home"==currentLevel&&aboutguy.interactible&&(dUI.open?continueDialog():(dUI.open=!0,dUI.t=aboutguy,pickDialog(),dUI.line=texts[saveData.textProgress].split(" "),revealedLink.includes("_")||pickNextLinkAward(),cutDialog()),agTalkCounter=6+randInt(9),clearTimeout(agTalkTimeout),aboutGuyTalk())},pickDialog=()=>{let e=saveData.gameProgress,t=saveData.directoryProgress,a=saveData.bossProgress,s=!1,l=0;awarded("start")&&(0==a&&0==a?l=1+randInt(3):a>0&&(awarded("r4")?a>1?l=10:1==a?s=!0:l=11:(e.push("r4"),l=9)),(t>0||s)&&(1==t?l=4:t>1&&!awarded("r1")?(e.push("r1"),l=5):t>3&&!awarded("r2")?(e.push("r2"),l=6):t>5&&!awarded("r3")?(e.push("r3"),l=7):l=7==t?8:12+randInt(3))),saveData.textProgress=l},awarded=e=>saveData.gameProgress.includes(e),cantGoDown=!1,cantjetpack=!1,jetkeypressed=!1,keypress=()=>{if(!tFormSelected)switch(event.keyCode){case 65:player.goLeft();break;case 68:player.goRight();break;case 32:jetkeypressed||(jetkeypressed=!0,!player.jetpacks&&player.jumpForce<8&&player.fallSpeed<4&&(playHop(300),player.jump()),cantjetpack||(player.jetpacks=!0));break;case 83:player.y<killLine&&!cantGoDown&&player.y++;break;case 69:actionButton();break;case 27:dUI.open=!1}},keyrelease=()=>{if(!tFormSelected)switch(event.keyCode){case 65:player.movingLeft=!1;break;case 68:player.movingRight=!1;break;case 32:player.jetpacks=!1,jetkeypressed=!1}},mouseIsPressed=!1,mouseX=0,mouseY=0,cantShoot=!1,mousePressed=()=>{mouseIsPressed=!0,mouseX=event.clientX-canvas.x,mouseY=event.clientY-canvas.y,"start"!=currentLevel&&!cantShoot&&player.gunPower>=shotcost&&(player.gunPower-=shotcost,playBlaster(1800,3),player.shoot(mouseX,mouseY,25,!1),player.movingRight||player.movingLeft?playerModel.selectAnimation(3):playerModel.selectAnimation(1),cantShoot=!0,setTimeout(function(){resetPlayerAnimation(),cantShoot=!1},250))},mouseReleased=()=>mouseIsPressed=!1,datastrip=0,addLoot=()=>{textSpawnerGuy.doneSpawning||(updateInv(++datastrip),playCash(),datastrip>dataCost&&(datastrip-=dataCost,processDataStrips(),updateInv(datastrip)))},updateInv=e=>{textSpawnerGuy.spawner2text=revealedLink},items=[],generateLoot=(e,t,a)=>{let s=5+randInt(15),l="grey";for(let i=0;i<s;i++){null!=a&&(l=a[randInt(a.length)]),null!=t?items.push(new Item(e.x,e.y-50,8,l,!0)):items.push(new Item(e.x,e.y-50,10,l));let s=items[items.length-1];s.impactForce.x=6+randInt(12),Math.random()>.5&&(s.impactForce.x*=-1),s.initJumpForce=11,s.jump()}},updateItems=()=>{for(let e=items.length-1;e>=0;e--)items[e].update(),(items[e].looted||items[e].poofy&&items[e].pfact>30)&&items.splice(e,1)};class Item extends MovingObject{constructor(e,t,a,s,l){super(e,t,a,s),this.size=a,this.looted=!1,this.v=1,null!=l&&(this.poofy=!0,this.pfact=0)}update(){if(this.poofy)this.pfact++;else if(!this.looted){let e=distance(this.x,this.y,player.x,player.y);if(e.d<10)this.looted=!0,addLoot();else if(e.d<80){this.v++;let t=this.v/e.d;this.x+=t*e.adj,this.y+=t*e.opp,this.fallSpeed=0}else this.v>1&&this.v--}let e=this.display();0!=e&&cRect(e.x,e.y,this.size,this.size,this.fill)}}let lastp,ns1=58,ns2=93;class CoolPath{constructor(e,t,a,s){this.x=e,this.y=t,this.cmess,this.scale=1.5,null!=s&&(this.scale*=s),this.colors=[];for(let e=0;e<a.c.length;e++)this.colors[e]=a.c[e];this.model=a.m,this.rig=a.r,this.animations=a.a;for(let e=0;e<this.rig.length;e++)this.rig[e].isRoot&&(this.fullRig=new RigShape(e,this.scale,this.model,this.rig,this.animations,this.colors));this.selectAnimation(1),this.counter=0}selectAnimation(e){this.pose=e,this.fullRig.selectAnimation(e)}update(e,t){this.fullRig.updateRotationValues(),ctx.translate(this.x,this.y),t&&ctx.scale(-1,1),this.fullRig.display(ctx),ctx.resetTransform(),this.counter++,this.counter>this.animations[this.pose].animLength&&(this.counter=0)}}class RigShape{constructor(e,t,a,s,l,i){this.colors=i,this.rig=s,this.animations=l,this.sIndex=e,this.origin={x:s[e].origin.x*t,y:s[e].origin.y*t},this.rotation=0,this.paths=[],this.counter=0;for(let s=0;s<a.length;s++)if(a[s].shape==e){let e=a[s].origin,l=e.x*t,i=e.y*t,n=`M ${l} ${i} `,o=a[s].segments;for(let e=0;e<o.length;e++){n+=o[e].type+" ";let a=o[e].points;for(let e=0;e<a.length;e++)n+=`${l=a[e].x*t} ${i=a[e].y*t} `}this.paths.push({path:new Path2D(n),stroke:a[s].stroke,fill:a[s].fill})}this.pins=[];for(let n=0;n<s[e].pins.length;n++){let o=s[e].pins[n];this.pins.push({shape:new RigShape(o.shape,t,a,s,l,i),x:o.x*t,y:o.y*t})}}selectAnimation(e){this.pose=e;for(let t=0;t<this.pins.length;t++)this.pins[t].shape.selectAnimation(e)}updateRotationValues(){0==this.counter?this.rotation=this.animations[this.pose].initVals[this.sIndex]:this.rotation=this.getRotFromTimeStamps();for(let e=0;e<this.pins.length;e++)this.pins[e].shape.updateRotationValues();this.counter++,this.counter>this.animations[this.pose].animLength&&(this.counter=0)}display(e){e.save(),e.rotate(rad(this.rotation)),e.translate(-this.origin.x,-this.origin.y);for(let t=0;t<this.paths.length;t++)e.strokeStyle=this.colors[this.paths[t].stroke],e.lineWidth="2",e.stroke(this.paths[t].path);for(let t=0;t<this.pins.length;t++)e.save(),e.translate(this.pins[t].x,this.pins[t].y),this.pins[t].shape.display(e),e.restore();e.restore()}getRotFromTimeStamps(){let e=this.animations[this.pose],t=e.timeStamps[this.sIndex];if(t.length>0){for(let a=0;a<t.length;a++)if(this.counter<=t[a].time){setlast(0,0);let s=t[a-1];return a>0?setlast(s.time,s.rot):setlast(0,e.initVals[this.sIndex]),this.lerprot(t[a].time,t[a].rot)}let a=last(t);return setlast(a.time,a.rot),this.lerprot(e.animLength,e.initVals[this.sIndex])}return this.animations[this.pose].initVals[this.sIndex]}lerprot(e,t){return lastp.r+(this.counter-lastp.t)/(e-lastp.t)*(t-lastp.r)}}let riglength,playerModel,monsterModel,aboutModel,setlast=(e,t)=>lastp={t:e,r:t},cmess="",segments=[],newSeg=(e,t,a)=>segments.push({type:e,points:[{x:toNum(t,a),y:toNum(t+1,a)}]}),toNum=(e,t)=>cmess.charCodeAt(e)-t,isns1=(e,t)=>e.charCodeAt(t)<ns2,toAngle=e=>180*toNum(e,ns2)/30,unpackModelMessage=e=>{let t=e.split("*"),a=[];segments=[];for(let e=0;e<t.length;e++){cmess=t[e],segments=[];for(let a=5;a<t[e].length;a+=2)if(toNum(a,0)<ns2)newSeg("L",a,ns1);else{let e=segments.length-1;if(e>=0){let t=segments[e],s=t.points;"L"==t.type?newSeg("C",a,ns2):s.length<3?s.push({x:toNum(a,ns2),y:toNum(a+1,ns2)}):newSeg("C",a,ns2)}else newSeg("C",a,ns2)}let s=toNum(2,ns1);s>99&&(s/=100),a.push({shape:toNum(0,ns1),fill:toNum(1,ns1),stroke:s,origin:{x:toNum(3,ns1),y:toNum(4,ns1)},segments:segments})}return a},unpackRigMessage=e=>{let t=[],a=e;cmess=a;let s=0;for(let e=0;e<a.length;e++){let l=t[t.length-1];if(0==s)t.push({origin:{x:toNum(e,ns1)},pins:[],isRoot:!1});else if(1==s)l.origin.y=toNum(e,ns1);else if(s>2){let t=l.pins[l.pins.length-1];s%3==0?l.pins.push({x:toNum(e,ns2)}):s%3==1?l.pins[l.pins.length-1].y=toNum(e,ns2):t.shape=toNum(e,ns2)}else 2==s&&"1"==a[e]&&(l.isRoot=!0);++s>2&&isns1(a,e+1)&&(s=0)}return riglength=t.length,t},unpackAnimation=e=>{let t=[];cmess=e;let a=e,s=!1,l=0;for(;!s;){let e=a.indexOf("*",l+1),i={name:a.substring(l+1,e)};i.animLength=toNum(e+1,ns1);let n=e+1+riglength;i.initVals=[],i.timeStamps=[];for(let t=e+2;t<n+1;t++)i.initVals.push(toAngle(t));l=n+1;for(let e=0;e<riglength;e++){i.timeStamps.push([]);let e=a.indexOf("*",l+1);-1==e&&(e=a.length,s=!0);let t=0;for(let a=l+1;a<e;a++){let e=i.timeStamps[i.timeStamps.length-1];t%2==0?e.push({rot:toAngle(a)}):e[e.length-1].time=toNum(a,ns1),t++}l=e}t.push(i)}return t},nocolor="#0000",edata={m:unpackModelMessage(":;:HVDOhgkaskooniqikklinf*;;:AETMQOQL*<;:AGOMOKML*=;:FAHJEOIP*>;:FAHJEOIP"),r:unpackRigMessage("GQ1im^in_jx`kxaAE0AG0FA0FA0"),a:unpackAnimation("*run*F^]]hQ*\\@*[@*[@*R@*j@*eat*F]]]iS*W<\\@*X<]@TB*c<]@eB*Q@*j@*fall*PbZ^QP*_C*YC*ZC*QC*TC"),c:["#eccf",nocolor]},abdata={m:unpackModelMessage(":;:GRKPCI*;;:LAJEJIHI*<;:LAJEJIHI*=;:AOLK*>;:BBMI*?;:OHBDechdghidkeji*@;:BEOI"),r:unpackRigMessage("GR1ku^iu_fl`LA0LA0AO0onaMI0eebeecBD0BD0"),a:unpackAnimation("*still*PVcgd]WX*[D*]D*dD*YD*eD*QD*YD*talk*FZadcZXX*XC*aC*fC*a>c@eC*]>Z@\\C*R>W@SC*\\>W@[C"),c:["#ada",nocolor]},s1data={m:unpackModelMessage(":;:SDH<>CHKSDSPHX>P>JHRSKNNNGC?M@CGCT>P>C*;;:HDHL*<;:KJFE*<;<GDibbhhi*<;<LItmosmn"),r:unpackRigMessage("HL0HE1ki]kg_HH0"),a:unpackAnimation("*ya*J]]]*[D**yB*"),c:["#dcd",nocolor,"rgba(174,44,0,1.0)"]},pdata={m:unpackModelMessage(":;ŦBALDnjijlfhifhhe*;;<FGJH*<;<FHJI*:;>GJfoblfe*=;>GOFJGB*>;>EFH@*?;ĂEFGM*@;>EFH@*A;ĂEFGM*B;ĂHEJLIOMO*C;ĂHEJLIOMO*D;ŦFNJLHNHKNS"),r:unpackRigMessage("DH0ij^ik_FG0FH0FJ1kc]geamfchpekpfH@0hibEF0H@0hidEF0jpgHE0HE0GM0"),a:unpackAnimation("*still*PZ]]]X]XS]]W*]E*YH*^H**ZE*YE*ZE*****shoot*B]]]]a[N_]]`*_<*W>*`>*[<*j<*]<*N<*[<*e<*`<*V<*run*D\\]]]e]TPhW_*Y?***^?*O?*T?*e?*`?*T?*i?*R?*runshot*D]]]]h]LdiU]****Y?*N?**P?*S?*W?*m?**gethit*JS]]bd^mdmH]*I=*W=*b=**M=*Y=*@=WA*U=JA*p=MA*a=_A**jump*V]]]`_a`V[Z]*[?***c?*M?*W?*G?**M?*L?*\\?"),c:["rgba(0,0,0,1.0)",nocolor,"rgba(249,79,0,1.0)","rgba(138,131,248,1.0)","rgba(247,185,0,1.0)"]},loadModelData=()=>{(playerModel=new CoolPath(0,0,pdata,1.5)).selectAnimation(1),(aboutModel=new CoolPath(0,0,abdata,2)).selectAnimation(0)};const friction=2;class MovingObject extends DisplayObject{constructor(e,t,a,s){super(e,t,a,a),this.fill=s,this.hasGravity=!0,this.fallAcc=2,this.lrMaxSpeed=12,this.lrAcc=1,this.initJumpForce=25,this.movingLeft=!1,this.movingRight=!1,this.jumpForce=0,this.jumpDecel=2.2,this.fallSpeed=0,this.lrSpeed=0,this.impactForce={x:0,y:0},this.hitPoints=100,this.jetpacks=!1}goLeft(){this.movingRight=!1,this.movingLeft=!0,this.facing="left"}goRight(){this.movingRight=!0,this.movingLeft=!1,this.facing="right"}display(){this.moveLeftRight(),this.applyPhysics();let e=this.position();return this.hitPoints<100&&this.displayHealthBar(),e}displayHealthBar(){progressBar(this.screenPos.x,this.screenPos.y-35,30,10,this.hitPoints,"red","white")}jump(){this.jumpForce=this.initJumpForce}moveLeftRight(){this.movingLeft&&!this.movingRight?(this.lrSpeed-=this.lrAcc,this.lrSpeed=Math.max(this.lrSpeed,-this.lrMaxSpeed)):this.movingRight&&!this.movingLeft?(this.lrSpeed+=this.lrAcc,this.lrSpeed=Math.min(this.lrSpeed,this.lrMaxSpeed)):this.lrSpeed+friction<0?this.lrSpeed+=friction:this.lrSpeed-friction>0?this.lrSpeed-=friction:this.lrSpeed=0,this.impactForce.x-1>0?this.impactForce.x--:this.impactForce.x+1<0?this.impactForce.x++:this.impactForce.x=0,this.x+=this.lrSpeed+this.impactForce.x}applyPhysics(){this.updateFallSpeed(),this.jumpForce-this.jumpDecel>0?this.jumpForce-=this.jumpDecel:this.jumpForce=0,this.jetpacks&&(this.fallSpeed=0),this.y+=this.fallSpeed-this.jumpForce}updateFallSpeed(){let e=level1.platforms,t=killLine;for(let a=0;a<e.length;a++)this.x>e[a].x-e[a].w2&&this.x<e[a].x+e[a].w2&&e[a].y>=this.y+this.h/2&&e[a].y<t&&(t=e[a].y,this.currentPlatform=a);this.y+this.h/2+this.fallSpeed<t?this.fallSpeed+=this.fallAcc:(this.y=t-this.h/2,this.impactForce.y=this.fallSpeed,this.fallSpeed=0)}}class DisplayObject{constructor(e,t,a,s){this.x=e,this.y=t,this.w=a,this.h=s,this.w2=this.w/2,this.h2=this.h/2}position(){return checkCollision(getBounds(this),camera)?this.screenPos=getScreenPos(this):this.screenPos=!1,this.screenPos}limitX(){this.x=Math.min(Math.max(this.x,-sceneW/2),sceneW/2)}shoot(e,t,a,s){e<this.screenPos.x?this.facing="left":this.facing="right",projectiles.push(new Projectile(this.x,this.y,6,"green",a,e,t,s))}}class Projectile extends MovingObject{constructor(e,t,a,s,l,i,n,o){super(e,t,a,s),this.hitsplayer=o,this.destroyed=!1,this.y-=20;let r=this.position(),h=distance(r.x,r.y,i,n),c=l/h.d;this.speedVect={y:c*h.opp,x:c*h.adj},this.hasGravity=!1,this.lifeTimer=0}updateProjectile(){if(this.lifeTimer++,this.destroyed){let e=this.display();0!=e&&cRect(e.x,e.y,this.size,this.size,"white")}else{this.x+=this.speedVect.x,this.y+=this.speedVect.y,cFill("#4a8f");let e=this.position();if(this.size=10,0!=e){this.hitsplayer?checkCollision(getBounds(this),getBounds(player))&&(this.stopProjectile(),this.bump(player,8),playDamageFX(),damagePlayer(enemyShooterDamage)):(this.checkForCollisions(level1.platforms,!1),this.checkForCollisions(enemies,25),cFill(this.fill),this.size=4),this.checkWallCollisions();let t=this.lifeTimer%6;cRect(e.x-t,e.y-t,this.size+2*t,this.size+2*t),cFill("white"),cRect(e.x,e.y,this.size,this.size)}}}checkWallCollisions(){(this.x<-sceneW/2||this.x>sceneW/2)&&this.stopProjectile()}checkForCollisions(e,t){for(let a=0;a<e.length;a++)checkCollision(getBounds(e[a]),getBounds(this))&&(this.stopProjectile(),0!=t&&(awarded("r1")&&(t*=2),"spawner"==e[a].type?(e[a].hitPoints=0,e[a].spawnMore()):"spawner2"!=e[a].type&&(this.bump(e[a],4),e[a].hitPoints-=t),playBlaster(200,6)))}bump(e,t){e.impactForce.x+=Math.min(Math.max(e.x-this.x,-t),t)}stopProjectile(){this.speedVect.x=0,this.speedVect.y=0,this.destroyed=!0}}let projectiles=[],updateProjectiles=()=>{for(let e=projectiles.length-1;e>=0;e--)projectiles[e].updateProjectile(),projectiles[e].lifeTimer>50&&projectiles.splice(e,1)},saveData=null,loadSave=()=>{null==(saveData=JSON.parse(localStorage.getItem(saveDataHeader)))?newGameSave():console.log("Loaded Save")},newGameSave=()=>{console.log("new save"),saveData={levels:[],textProgress:0,directoryProgress:0,bossProgress:0,gameProgress:[]}};window.onbeforeunload=saveGame;let canvasElw,canvasElh,addbar,textform,listform,levelData,favblinginterval,fav,level1,saveDataHeader="sams404gameforjs13kof2020",saveGame=()=>localStorage.setItem(saveDataHeader,JSON.stringify(saveData)),createCanvas=()=>{canvas.w=800,canvas.h=600,canvas.w2=canvas.w/2,canvas.h2=canvas.h/2,canvas.c=document.createElement("canvas"),canvas.c.setAttribute("width",canvas.w),canvas.c.setAttribute("height",canvas.h),(ctx=canvas.c.getContext("2d")).filter="contrast(1.5) drop-shadow(1px 1px 2px #000)"},seedL=100,maxchar=100,charStart=128,ncount=0,random=()=>{let e=noiz(flo(ncount+=.7),currentLevel);return ncount%1*(noiz(Math.ceil(ncount),currentLevel)-e)+e},noiz=(e,t)=>(levelData.seedData.charCodeAt(e%seedL)-charStart)/maxchar,setupRandomSeed=e=>{let t="";for(let e=0;e<seedL;e++)t+=String.fromCharCode(charStart+randInt(maxchar));return t},constrain=(e,t,a)=>Math.min(Math.max(e,t),a),checkCollision=(e,t)=>oneDintercept(e.left,e.right,t.left,t.right)&&oneDintercept(e.top,e.bottom,t.top,t.bottom),oneDintercept=(e,t,a,s)=>t>=a&&t<=s||e>=a&&e<=s||e<=a&&t>=s,getScreenPos=e=>({x:canvas.w2+e.x-camera.target.x-e.w2,y:canvas.h2+e.y-camera.target.y-e.h2}),progressBar=(e,t,a,s,l,i,n)=>{cFill(n),cRect(e,t,a,s),cFill(i),cRect(e,t,a*l/100,s)},distance=(e,t,a,s)=>{let l=a-e,i=s-t;return{d:Math.sqrt(l*l+i*i),adj:l,opp:i}},getBounds=e=>({left:e.x-e.w2,right:e.x+e.w2,top:e.y-e.h2,bottom:e.y+e.h2}),div=(e,t)=>{let a=document.createElement("div");return document.body.appendChild(a),null!=e&&setStyle(a,e,t),a},setStyle=(e,t,a)=>e.setAttribute("style",`position:fixed; left:${t.x}px;top:${t.y}px;width:${t.w}px;height:${t.h}px;background-color:${a};`),rad=e=>e*Math.PI/180,l=e=>e.length,randInt=e=>flo(Math.random()*e),flo=e=>Math.floor(e),reach=(e,t,a)=>{let s=!1,l=!1;return e.x+a<t.x?e.x+=a:e.x-a>t.x?e.x-=a:(e.x=t.x,s=!0),e.y+a<t.y?e.y+=a:e.y-a>t.y?e.y-=a:(e.y=t.y,l=!0),!(!s||!l)},last=e=>e[e.length-1],isLevel=e=>{let t=saveData.levels;for(let a=0;a<t.length;a++)if(t[a].name==e)return a;return-1},pointTo=e=>document.getElementById(e),cFill=e=>{ctx.fillStyle=e},cText=(e,t,a,s,l)=>{s&&cFill(s),l&&cFont(l),ctx.fillText(e,t,a)},cFont=e=>{ctx.font=e+"px Courier New"},cRect=(e,t,a,s,l)=>{l&&cFill(l),ctx.fillRect(e,t,a,s)},waittime=5,runFadeIn=()=>{let e=1;fadeIn>waittime&&(e=1-(fadeIn-waittime)/30),e>0&&(cRect(0,0,canvas.w,canvas.h,"rgba(0,0,0,"+e+")"),cText(fadetxt,canvas.w/2-30,canvas.h/2-2,"white",20)),fadeIn++},fadetxt="",fade=(e,t)=>{fadeIn=0,waittime=e,fadetxt=null!=t?t:""},addressbar=()=>{let e=(addbar=div()).style;e.width=canvas.w+"px",e.backgroundColor="grey",e.display="flex",e.flexDirection="row",e.justifyContent="space-around",updateFavorites(),document.body.appendChild(canvas.c);let t=canvas.c.getBoundingClientRect();canvas.x=Math.round(t.x),canvas.y=Math.round(t.y)},setupLevel=()=>{let e=isLevel(currentLevel);console.log(e,currentLevel),-1!=e?levelData=saveData.levels[e]:(console.log("new level data"),newLevel(dif),levelData=last(saveData.levels))},dif=0,newLevel=e=>{blingFavorites(),0!=lvlCount&&lvlCount%lvlDiffIncreaseInterval==0&&(dif=Math.min(enemyDifficulty+1,maxEnemyDifficulty)),lvlCount++,null==e&&(e=currentlevel),saveData.levels.push({name:e,seedData:setupRandomSeed(),difficulty:1+flo(lvlCount/2),cleared:!1,cleared2:!1,sections:0})},saveLevelData=()=>{if("home"!=currentLevel&&"start"!=currentLevel){let e=isLevel(currentLevel);saveData.levels[e].cleared=levelData.cleared,saveData.levels[e].cleared2=levelData.cleared2,saveData.levels[e].sections=levelData.sections}},goToLink=()=>{let e=listform.value;return"home"==e?(loadHomeLevel(),void updateFavorites()):"start"==currentLevel&&"new"==e?(newGameSave(),loadHomeLevel(),void updateFavorites()):void(0!=saveData.levels.length&&(null!=levelData&&saveLevelData(),currentLevel=e.substring(0,e.indexOf(" ")),fade(24),setupLevel(),createLevel(),createPlayer()))},loadHomeLevel=()=>{currentLevel="home",createLevel(),createPlayer(),fade(8)},directorylevels=["submit","entries","partners","experts","prizes","rules","blog"],allLinkNames=["submit","blog","entries","partners","experts","prizes","rules","evilbot","invaderz"],nextLink="",revealedLink="",revealedChars=0,dataCost=10,processDataStrips=()=>{let e=revealedLink.length,t=randInt(e);for(;"_"!=revealedLink[t];)t=randInt(e);revealedLink=t<nextLink.length-1?rSub(0,t)+nextLink[t]+rSub(t+1,e):rSub(0,t)+nextLink[t],++revealedChars==e&&(newLevel(nextLink),enemies[0].unlocked=!0,level1.clearLevel2(),levelData.cleared2=!0,saveData.directoryProgress++,textSpawnerGuy.doneSpawning=!0,updateFavorites())},rSub=(e,t)=>revealedLink.substring(e,t),randomlink=()=>allLinkNames[randInt(allLinkNames.length)],linkCounter=1,pickNextLinkAward=()=>{nextLink=allLinkNames[linkCounter],linkCounter++,revealedLink="",revealedChars=0;for(let e=0;e<nextLink.length;e++)revealedLink+="_"},displayStartUI=()=>{cRect(0,0,canvas.w,canvas.h,"#aab"),cFill("black"),cText("sam's js13k game",50,50),cText("pick 'home' in the select tool above to continue last save,",50,65),cText("or pick 'new' to start a new game.",50,80),cText("CONTROLS",50,120),cText("Left: A. Right: D. Down: S. Jump: Space.",50,135),cText("Shoot: Click. ",50,150),cText("Talk to the home page guy: E.",50,165)},tFormSelected=!1,updateFavorites=()=>{let e="<option> home </option>";if("start"==currentLevel)e="<option> home </option><option> new </option>";else for(let t=0;t<saveData.levels.length;t++){let a=saveData.levels[t];e+=`<option>${a.name} difficulty: ${a.difficulty}</option>`}let t=`favorites:<select id="favorites" style='cursor:pointer;'> ${e} </select>`;addbar.innerHTML=`<span> <span class='hov abel'> < </span> <span class='hov abel'> > </span> </span>\n        <span class='abel'> www.coolsite.com/${currentLevel} </span>\n                <span  class='abel' id='favs'> ${t} <span class='hov abel' onclick='goToLink()'>go</span> </span>`,listform=pointTo("favorites"),t=pointTo("favs"),saveGame()},back=()=>console.log("back"),forward=()=>console.log("forward"),favBling=0,blinging=!1,blingFavorites=()=>{blinging||(blinging=!0,playCash(),favblinginterval=setInterval(function(){(fav=pointTo("favs")).style.backgroundColor=favBling%2==0?"blue":"white",favBling++},400),setTimeout(function(){fav.style.backgroundColor="white",clearInterval(favblinginterval),blinging=!1},5e3))},killLine=500,sceneW=0,fadeIn=0,enemies=[],lvlCount=0,enemyDifficulty=1,lvlDiffIncreaseInterval=3,maxEnemyDifficulty=3,bgurl="js/characters/enemyclass.js",basicLevel=e=>{sceneW=canvas.w,level1=new Level([[50,killLine-100,100],[-60,killLine-60,100],[0,killLine,canvas.w]],sceneW,100,e)},continueLevel=e=>{let t=[[0,killLine+=500,sceneW]],a=flo(3+3*random()),s=flo(1+3*random());for(let l=0;l<s;l++){let i=-s/3*canvas.w+l*sceneW/s+75,n=killLine;for(let s=0;s<a;s++){let l=50;n-=60,s==a-1&&(l=250,e&&enemies.push(new Enemy(i,n-80,0,0,"spawner"))),t.push([i,n,l+50*random()]),i+=80*random()-40}}for(let e=0;e<t.length;e++){let a=level1.getplatformtext(t[e][2]);level1.platforms.push(new Platform(t[e][0],t[e][1],t[e][2],a))}level1.moreClouds(2),level1.newWalls(sceneW)},createLevel=()=>{if(enemies=[],items=[],killLine=500,ncount=0,dUI.open=!1,"home"==currentLevel)basicLevel(),createFriendlyNPCs();else if(directorylevels.includes(currentLevel)){sceneW=2*canvas.w;let e=(level1=new Level([[0,killLine,sceneW]],sceneW,400,!0)).platforms[0],t=levelData.sections;if(levelData.cleared&&level1.clearLevel(),0==t)enemies.push(new Enemy(e.x,e.y-80,0,0,"spawner"));else for(let e=0;e<t;e++)continueLevel(e==t-1&&!levelData.cleared);levelData.cleared2?level1.clearLevel2():levelData.cleared&&level1.addSpawner2(),updateFavorites()}else{basicLevel(!0);let e=level1.platforms[0];levelData.cleared?level1.clearLevel():enemies.push(new Enemy(e.x,e.y-80,0,0,"boss"))}};class Level{constructor(e,t,a,s){if(null!=s){let t=e[0];this.text404=new DisplayObject(t[0]-10,t[1]-10,300,300)}this.platforms=[],this.bgFill="#333F",this.txtCounter=0;for(let t=0;t<e.length;t++){let a=this.getplatformtext(e[t][2]);this.platforms.push(new Platform(e[t][0],e[t][1],e[t][2],a))}this.clouds=[],this.moreClouds(3),this.newWalls(sceneW),this.bgTxt=new DisplayObject(t/2,this.platforms[0].y+a,2*t,4*a),this.bgcounter=0,this.thunder=100,this.drops=[],this.cleared=!1,this.cleared2=!1}moreClouds(e){for(let t=0;t<e;t++){let e=3+randInt(4),a=[];for(let t=0;t<e;t++)a.push(this.getplatformtext(30+randInt(100)));let s=1;t%2==0&&(s=-1),this.clouds.push({o:new DisplayObject(0+200*t+randInt(100),killLine+randInt(450),1e3,1e3),t:a,n:randInt(200),dir:s})}}getplatformtext(e){let t="";for(let a=0;a<e/3;a++)t+=bgText[this.txtCounter],this.txtCounter++,this.txtCounter==bgText.length&&(this.txtCounter=0);return t}addSpawner2(){let e=this.platforms[1+randInt(this.platforms.length-1)];enemies.push(new Enemy(e.x,e.y-80,0,0,"spawner2")),textSpawnerGuy=last(enemies)}clearLevel(){this.cleared=!0,this.bgFill="#666"}clearLevel2(){this.cleared2=!0,this.bgFill="#ccc"}newWalls(e){this.walls=[new DisplayObject(-.75*e,0,e/2,2e3),new DisplayObject(.75*e,0,e/2,2e3),new DisplayObject(0,killLine+520,2e3,1e3)]}displayBackground(){if(cRect(0,0,canvas.w,canvas.h,this.bgFill),this.bgcounter>this.thunder&&!level1.cleared2){let e=10-(this.bgcounter-this.thunder);if(e>=0)cRect(0,0,canvas.w,canvas.h,"#FFF"+e);else if(Math.random()<.3)this.thunder+=50+randInt(100),playThunder();else{let e=200;level1.cleared&&(e=20),this.thunder+=e+randInt(e),playThunder()}}for(let e=0;e<this.clouds.length;e++){let t=this.clouds[e];if(t.o.position(),0!=t.o.screenPos)for(let e=0;e<t.t.length;e++)cText(t.t[e],t.o.screenPos.x*(.7+.03*e),.8*t.o.screenPos.y+15*e,"#bbb3",30);t.o.x+=.2*t.dir,this.bgcounter%150==0&&Math.random()>.5&&(t.dir*=-1)}let e=this.bgTxt.position();for(let t=this.drops.length-1;t>=0;t--){let a=this.drops[t];a.y+=20,cText(bgText[a.c],e.x+a.x,e.y+a.y,"#bbba",12),a.y>player.y&&this.drops.splice(t,1)}this.bgcounter%4==0&&this.drops.push({x:player.x+randInt(canvas.w),y:player.y-800,c:randInt(400)}),this.bgcounter++}display404Background(){let e=this.text404.position();cText("404",e.x,e.y,"black",100),cText("return to last page...",e.x,e.y+50,"black",30)}displayPlatforms(){for(let e=0;e<this.platforms.length;e++)this.platforms[e].display();cFill("black");for(let e=0;e<this.walls.length;e++){let t=this.walls[e],a=t.position();0!=a&&ctx.fillRect(a.x,a.y,t.w,t.h)}}}let platformHeight=10,platformFill="#a43f";class Platform extends DisplayObject{constructor(e,t,a,s){super(e,t,a,platformHeight),this.fill=platformFill,this.ptext=s,console.log(s)}display(){let e=this.position();if(0!=this.screenPos){ctx.strokeStyle="#a438",ctx.strokeRect(e.x,e.y,this.w,20);let t=this.ptext.length;cText(this.ptext.substring(0,t/2),e.x,e.y+8,this.fill,10),cText(this.ptext.substring(t/2,t),e.x,e.y+18,this.fill,10)}}}let bgText,start=()=>{loadSave(),fadeIn=0,createCanvas(),addressbar(),loadModelData(),startSound(),fetch(bgurl).then(e=>e.text()).then(e=>bgText=e.replace(" ","")),setInterval(run,33)};window.onload=start;let currentLevel="start",run=()=>{if("start"!=currentLevel){let e="home"==currentLevel;cameraFollow(player.x,player.y),level1.displayBackground(),e||level1.display404Background(),level1.displayPlatforms(),e&&runFriendlyNPCs(),updateEnemies(),updatePlayer(),updateProjectiles(),runDialog(),updateItems(),runFadeIn(),progressBar(10,canvas.h-40,100,30,player.gunPower,"orange","grey"),progressBar(canvas.w-110,canvas.h-40,100,30,player.jetFuel,"blue","grey")}else displayStartUI()};
